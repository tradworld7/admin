<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade World - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* All previous CSS styles remain exactly the same */
        :root {
            --primary-color: #4361ee;
            --primary-light: #e6e9ff;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --success-light: #e6f7fd;
            --danger-color: #f72585;
            --danger-light: #fde6ef;
            --warning-color: #f8961e;
            --warning-light: #fef3e6;
            --info-color: #4895ef;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --gray-light: #e9ecef;
            --white-color: #ffffff;
            --sidebar-width: 250px;
            --header-height: 70px;
            --transition: all 0.3s ease;
            --border-radius: 10px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        /* Rest of your existing CSS... */
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <i class="fas fa-user-shield logo-icon"></i>
            <span class="logo-text">Trade World Admin</span>
        </div>
        
        <div class="user-profile" id="userProfile">
            <div class="user-avatar" id="userAvatar">A</div>
            <button id="logoutBtn" class="btn btn-primary btn-sm">Logout</button>
        </div>
        
        <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <!-- Sidebar Menu -->
    <aside class="sidebar" id="sidebar">
        <ul class="sidebar-menu">
            <li><a href="#" class="active" id="dashboardLink"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
            <li><a href="#" id="usersLink"><i class="fas fa-users"></i> Users</a></li>
            <li><a href="#" id="transactionsLink"><i class="fas fa-exchange-alt"></i> Transactions</a></li>
            <li><a href="#" id="packagesLink"><i class="fas fa-box-open"></i> Packages</a></li>
            <li><a href="#" id="settingsLink"><i class="fas fa-cog"></i> Settings</a></li>
        </ul>
    </aside>

    <!-- Admin Content Sections -->
    <div class="admin-container" id="adminContent">
        <!-- All your existing admin content sections remain the same -->
        <!-- Dashboard, Users, Transactions, Packages, Settings sections -->
    </div>

    <!-- Login Modal (hidden when logged in) -->
    <div id="loginModal" class="auth-container" style="display: none;">
        <div class="auth-card">
            <h2 class="auth-title">Admin Login</h2>
            <form id="loginForm">
                <div class="form-group mb-3">
                    <label for="loginEmail">Admin Email</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="rkv858810@gmail.com" required>
                </div>
                <div class="form-group mb-3">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="123@rkve858810" required>
                </div>
                <button type="submit" class="btn btn-primary w-100" id="loginBtn">
                    <span id="loginBtnText">Login</span>
                    <span id="loginSpinner" class="spinner" style="display: none;"></span>
                </button>
            </form>
            <div class="auth-footer">
                Don't have an account? <a href="signup.html">Sign Up</a>
            </div>
        </div>
    </div>

    <!-- Toast Notifications Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            signOut,
            signInWithEmailAndPassword
        } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";
        import { 
            getDatabase, 
            ref, 
            onValue, 
            set, 
            update, 
            push, 
            get,
            remove
        } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBshAGZScyo7PJegLHMzORbkkrCLGD6U5s",
            authDomain: "mywebsite-600d3.firebaseapp.com",
            databaseURL: "https://mywebsite-600d3-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mywebsite-600d3",
            storageBucket: "mywebsite-600d3.appspot.com",
            messagingSenderId: "584485288598",
            appId: "1:584485288598:web:01856eaa18ba5ada49e0b7",
            measurementId: "G-GQ9J9QH42J"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Only allow this specific admin email
        const ADMIN_EMAIL = "rkv858810@gmail.com";

        document.addEventListener('DOMContentLoaded', function() {
            // Check auth state
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    if (user.email === ADMIN_EMAIL) {
                        // Show admin panel
                        document.getElementById('loginModal').style.display = 'none';
                        document.getElementById('adminContent').style.display = 'block';
                        document.getElementById('sidebar').style.display = 'block';
                        document.getElementById('userProfile').style.display = 'flex';
                        
                        // Load admin data
                        loadAdminData();
                    } else {
                        // Not the authorized admin
                        signOut(auth);
                        showLoginModal();
                        showToast('Unauthorized access. Only admin can access this panel.', 'error');
                    }
                } else {
                    // No user logged in
                    showLoginModal();
                }
            });

            // Setup login form
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                const loginBtn = document.getElementById('loginBtn');
                const loginBtnText = document.getElementById('loginBtnText');
                const loginSpinner = document.getElementById('loginSpinner');
                
                loginBtn.disabled = true;
                loginBtnText.textContent = 'Logging in...';
                loginSpinner.style.display = 'inline-block';
                
                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    if (email === ADMIN_EMAIL) {
                        showToast('Admin login successful!', 'success');
                        document.getElementById('loginModal').style.display = 'none';
                    } else {
                        await signOut(auth);
                        showToast('Invalid admin credentials', 'error');
                    }
                } catch (error) {
                    let errorMessage = 'Login failed';
                    if (error.code === 'auth/invalid-login-credentials') {
                        errorMessage = 'Invalid email or password';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Account temporarily disabled due to many failed attempts';
                    }
                    showToast(errorMessage, 'error');
                }
                
                loginBtn.disabled = false;
                loginBtnText.textContent = 'Login';
                loginSpinner.style.display = 'none';
            });

            // Setup logout
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    showToast('Logged out successfully', 'success');
                    showLoginModal();
                } catch (error) {
                    showToast('Error logging out', 'error');
                }
            });

            // All your existing admin panel functionality remains the same
            // (dashboard, users, transactions, packages, settings functionality)
        });

        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('adminContent').style.display = 'none';
            document.getElementById('sidebar').style.display = 'none';
            document.getElementById('userProfile').style.display = 'none';
        }

        function showToast(message, type) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button class="toast-close">&times;</button>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
            
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.remove();
            });
        }

        // All your existing admin panel functions remain the same
        async function loadAdminData() {
            // Your existing dashboard loading logic
        }

        // Other functions...
    </script>
</body>
</html>
